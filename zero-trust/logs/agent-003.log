INFO:agent.app:[2m2025-08-27T01:00:26.826233Z[0m [[32m[1minfo     [0m] [1mAgent logging configuration   [0m [[34m[1magent.app[0m] [36mdebug_agent[0m=[35mFalse[0m [36mdebug_all[0m=[35mFalse[0m [36mlog_level[0m=[35mINFO[0m
INFO:agent.app:[2m2025-08-27T01:00:26.842453Z[0m [[32m[1minfo     [0m] [1mUsing agent-specific TPM context file[0m [[34m[1magent.app[0m] [36magent_name[0m=[35magent-unregistered-003[0m [36mcontext_path[0m=[35mtpm/agent-unregistered-003.ctx[0m
INFO:utils.tpm2_utils:[2m2025-08-27T01:00:26.847132Z[0m [[32m[1minfo     [0m] [1mSoftware TPM (swtpm) is accessible[0m [[34m[1mutils.tpm2_utils[0m] 
INFO:agent.app:[2m2025-08-27T01:00:26.858857Z[0m [[32m[1minfo     [0m] [1mTPM2 utilities initialized successfully[0m [[34m[1magent.app[0m] [36magent_name[0m=[35magent-unregistered-003[0m [36mcontext_path[0m=[35mtpm/agent-unregistered-003.ctx[0m [36muse_swtpm[0m=[35mTrue[0m
INFO:agent.app:[2m2025-08-27T01:00:26.865755Z[0m [[32m[1minfo     [0m] [1mSkipping OpenTelemetry metrics setup for compatibility[0m [[34m[1magent.app[0m] 
INFO:agent.app:[2m2025-08-27T01:00:26.866678Z[0m [[32m[1minfo     [0m] [1mOpenTelemetry setup completed (OTLP export disabled)[0m [[34m[1magent.app[0m] 
🚀 Starting agent: agent-unregistered-003
📁 Config file: agents/agent-unregistered-003/config.json
🌐 Agent port: 8403
🔐 APP_HANDLE: 0x8101000D
🔗 Gateway: localhost:9000
📊 Collector: localhost:8500
 * Serving Flask app 'agent.app'
 * Debug mode: off
INFO:agent.app:[2m2025-08-27T01:00:27.945427Z[0m [[32m[1minfo     [0m] [1m🔄 [AGENT] Initiating nonce retrieval for metrics[0m [[34m[1magent.app[0m] [36magent_name[0m=[35magent-unregistered-003[0m [36mmetric_type[0m=[35mapplication[0m
INFO:agent.app:[2m2025-08-27T01:00:27.945968Z[0m [[32m[1minfo     [0m] [1m🔄 [AGENT] Starting nonce request[0m [[34m[1magent.app[0m] [36magent_name[0m=[35magent-unregistered-003[0m [36mconfig_path[0m=[35magents/agent-unregistered-003/config.json[0m [36mgateway_url[0m=[35mhttps://localhost:9000[0m
INFO:agent.app:[2m2025-08-27T01:00:27.951811Z[0m [[32m[1minfo     [0m] [1m📤 [AGENT] Sending nonce request to gateway[0m [[34m[1magent.app[0m] [36magent_name[0m=[35magent-unregistered-003[0m [36mpublic_key_hash[0m=[35m2796d33dcbdc5464...[0m
INFO:agent.app:[2m2025-08-27T01:00:27.952050Z[0m [[32m[1minfo     [0m] [1m🔍 [AGENT] Signature-Input header created[0m [[34m[1magent.app[0m] [36magent_name[0m=[35magent-unregistered-003[0m [36msignature_input[0m=[35mkeyid="2796d33dcbdc5464e11991a09229c90a6d2c610bc6d32fdb379106b639e921db", created=1756256427, expires=1756256727, alg="Ed25519", nonce="9feea53a7118a22d975fcad4ec623053"[0m
INFO:agent.app:[2m2025-08-27T01:00:27.952237Z[0m [[32m[1minfo     [0m] [1m📤 [AGENT] Final headers for nonce request (public key hash only)[0m [[34m[1magent.app[0m] [36magent_name[0m=[35magent-unregistered-003[0m [36mheaders[0m=[35m{'Signature-Input': 'keyid="2796d33dcbdc5464e11991a09229c90a6d2c610bc6d32fdb379106b639e921db", created=1756256427, expires=1756256727, alg="Ed25519", nonce="9feea53a7118a22d975fcad4ec623053"'}[0m
ERROR:agent.app:[2m2025-08-27T01:00:27.972823Z[0m [[31m[1merror    [0m] [1m❌ [AGENT] HTTP error from gateway during nonce request[0m [[34m[1magent.app[0m] [36merror_details[0m=[35mAgent not found in allowlist[0m [36mrejected_by[0m=[35mgateway[0m [36mresponse_text[0m=[35m{"details":{"allowlist_status":"not_found","public_key_hash":"2796d33dcbdc5464e11991a09229c90a6d2c610bc6d32fdb379106b639e921db","validation_type":"public_key_hash"},"error":"Agent not found in allowli[0m [36mstatus_code[0m=[35m403[0m [36mvalidation_type[0m=[35magent_verification[0m
INFO:agent.app:[2m2025-08-27T01:00:27.973226Z[0m [[32m[1minfo     [0m] [1m✅ [AGENT] Successfully parsed error response JSON[0m [[34m[1magent.app[0m] [36merror_response[0m=[35m{'details': {'allowlist_status': 'not_found', 'public_key_hash': '2796d33dcbdc5464e11991a09229c90a6d2c610bc6d32fdb379106b639e921db', 'validation_type': 'public_key_hash'}, 'error': 'Agent not found in allowlist', 'rejected_by': 'gateway', 'timestamp': '2025-08-27T01:00:27.961658', 'validation_type': 'agent_verification'}[0m
ERROR:agent.app:[2m2025-08-27T01:00:27.981112Z[0m [[31m[1merror    [0m] [1m❌ [AGENT] Nonce request failed[0m [[34m[1magent.app[0m] [36merror[0m=[35m('Nonce request failed: Agent not found in allowlist (rejected by gateway)', {'details': {'allowlist_status': 'not_found', 'public_key_hash': '2796d33dcbdc5464e11991a09229c90a6d2c610bc6d32fdb379106b639e921db', 'validation_type': 'public_key_hash'}, 'error': 'Agent not found in allowlist', 'rejected_by': 'gateway', 'timestamp': '2025-08-27T01:00:27.961658', 'validation_type': 'agent_verification'})[0m
INFO:agent.app:[2m2025-08-27T01:00:27.981486Z[0m [[32m[1minfo     [0m] [1m🔍 [AGENT] ValueError details  [0m [[34m[1magent.app[0m] [36margs_content[0m=[35m('Nonce request failed: Agent not found in allowlist (rejected by gateway)', {'details': {'allowlist_status': 'not_found', 'public_key_hash': '2796d33dcbdc5464e11991a09229c90a6d2c610bc6d32fdb379106b639e921db', 'validation_type': 'public_key_hash'}, 'error': 'Agent not found in allowlist', 'rejected_by': 'gateway', 'timestamp': '2025-08-27T01:00:27.961658', 'validation_type': 'agent_verification'})[0m [36margs_length[0m=[35m2[0m [36margs_type[0m=[35m<class 'tuple'>[0m [36mhas_args[0m=[35mTrue[0m
INFO:agent.app:[2m2025-08-27T01:00:27.981749Z[0m [[32m[1minfo     [0m] [1m✅ [AGENT] Using enhanced error response[0m [[34m[1magent.app[0m] [36merror_response[0m=[35m{'details': {'allowlist_status': 'not_found', 'public_key_hash': '2796d33dcbdc5464e11991a09229c90a6d2c610bc6d32fdb379106b639e921db', 'validation_type': 'public_key_hash'}, 'error': 'Agent not found in allowlist', 'rejected_by': 'gateway', 'timestamp': '2025-08-27T01:00:27.961658', 'validation_type': 'agent_verification'}[0m
