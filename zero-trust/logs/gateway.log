INFO:__main__:[2m2025-09-02T04:20:10.913437Z[0m [[32m[1minfo     [0m] [1mGateway logging configuration [0m [[34m[1m__main__[0m] [36mdebug_all[0m=[35mFalse[0m [36mdebug_gateway[0m=[35mFalse[0m [36mlog_level[0m=[35mINFO[0m
INFO:__main__:[2m2025-09-02T04:20:10.925624Z[0m [[32m[1minfo     [0m] [1mSkipping OpenTelemetry metrics setup for compatibility[0m [[34m[1m__main__[0m] 
INFO:__main__:[2m2025-09-02T04:20:10.927202Z[0m [[32m[1minfo     [0m] [1mOpenTelemetry setup completed (OTLP export disabled)[0m [[34m[1m__main__[0m] 
INFO:__main__:[2m2025-09-02T04:20:10.932946Z[0m [[32m[1minfo     [0m] [1mGateway allowlist loaded      [0m [[34m[1m__main__[0m] [36magent_count[0m=[35m2[0m [36mpath[0m=[35mgateway/allowed_agents.json[0m
INFO:__main__:[2m2025-09-02T04:20:10.933559Z[0m [[32m[1minfo     [0m] [1müö® [GATEWAY] SIGNATURE_VALIDATION_CONFIG[0m [[34m[1m__main__[0m] [36menv_var_value[0m=[35mtrue[0m [36mvalidate_signature[0m=[35mTrue[0m
INFO:__main__:[2m2025-09-02T04:20:10.933858Z[0m [[32m[1minfo     [0m] [1mGateway allowlist manager initialized[0m [[34m[1m__main__[0m] [36magent_count[0m=[35m2[0m [36mallowlist_path[0m=[35mgateway/allowed_agents.json[0m [36mvalidate_geolocation[0m=[35mTrue[0m [36mvalidate_public_key_hash[0m=[35mTrue[0m [36mvalidate_signature[0m=[35mTrue[0m
INFO:__main__:[2m2025-09-02T04:20:10.980384Z[0m [[32m[1minfo     [0m] [1mGenerated temporary SSL certificates[0m [[34m[1m__main__[0m] [36mcert_path[0m=[35m/tmp/tmp9x4gqbmv.pem[0m [36mkey_path[0m=[35m/tmp/tmpjjk3ihz0.pem[0m
 * Serving Flask app 'app'
 * Debug mode: off
INFO:__main__:[2m2025-09-02T04:20:13.113228Z[0m [[32m[1minfo     [0m] [1müîç [GATEWAY] Full relevant headers for policy enforcement debugging[0m [[34m[1m__main__[0m] [36mContent-Type[0m=[35mNone[0m [36mSignature[0m=[35mNone[0m [36mSignature-Input[0m=[35mkeyid="bc4a5eaf76012122fc442d85c7317e1a7023e4cf30864235117935bab46423d9", created=1756786813, expires=1756787113, alg="RSA"[0m [36mWorkload-Geo-ID[0m=[35mNone[0m [36mendpoint[0m=[35m/nonce[0m [36mmethod[0m=[35mGET[0m
INFO:__main__:[2m2025-09-02T04:20:13.113937Z[0m [[32m[1minfo     [0m] [1müîç [GATEWAY] API call headers for policy enforcement debugging[0m [[34m[1m__main__[0m] [36mclient_ip[0m=[35mNone[0m [36mcontent_type[0m=[35mNone[0m [36mendpoint[0m=[35m/nonce[0m [36mexpected_headers_for_endpoint[0m=[35mSignature-Input only (no geolocation)[0m [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/nonce[0m [36mquery_params[0m=[35m{'public_key_hash': 'bc4a5eaf76012122fc442d85c7317e1a7023e4cf30864235117935bab46423d9'}[0m [36msignature_input_present[0m=[35mTrue[0m [36msignature_input_value[0m=[35mkeyid="bc4a5eaf76012122fc442d85c7317e1a7023e4cf30864235117935bab46423d9", created=1756786813, expires=1756787113, alg="RSA"[0m [36msignature_present[0m=[35mFalse[0m [36msignature_value[0m=[35mNone[0m [36muser_agent[0m=[35mpython-requests/2.31.0[0m [36mworkload_geo_id_present[0m=[35mFalse[0m [36mworkload_geo_id_value[0m=[35mNone[0m
INFO:__main__:[2m2025-09-02T04:20:13.118061Z[0m [[32m[1minfo     [0m] [1müìã [GATEWAY] Policy enforcement header summary[0m [[34m[1m__main__[0m] [36mendpoint[0m=[35m/nonce[0m [36mgeolocation_header_present[0m=[35mFalse[0m [36mpolicy_enforcement_ready[0m=[35mTrue[0m [36msignature_header_present[0m=[35mFalse[0m [36msignature_input_present[0m=[35mTrue[0m
INFO:__main__:[2m2025-09-02T04:20:13.118885Z[0m [[32m[1minfo     [0m] [1mSecurityManager validating nonce request - public key hash only[0m [[34m[1m__main__[0m] 
INFO:__main__:[2m2025-09-02T04:20:13.119363Z[0m [[32m[1minfo     [0m] [1m‚úÖ [GATEWAY] Nonce validation passed - public key hash only[0m [[34m[1m__main__[0m] 
INFO:__main__:[2m2025-09-02T04:20:13.139646Z[0m [[32m[1minfo     [0m] [1mNonce request proxied successfully[0m [[34m[1m__main__[0m] 
INFO:__main__:[2m2025-09-02T04:20:13.368200Z[0m [[32m[1minfo     [0m] [1müîç [GATEWAY] Full relevant headers for policy enforcement debugging[0m [[34m[1m__main__[0m] [36mContent-Type[0m=[35mapplication/json[0m [36mSignature[0m=[35m255cc7722eb72af0c2b5bb72d36a432d2a7f73073348413db79d3fd6c79f8533bdb0903062f6c5c9834610b43fd46d86d4ce283a54f12edc65d82bfb617844097bd191592b7dbe270bd053c2324538c1b0d590b692a5496f238907d1ca85c30211860399d5b8fe67ca57758aeaf9a65b4a9208ebf4fb7766663b943a3e5de2076932a6e89ed6bc358fa3035c6f4a394ae965d245bb0b7cae826b011e15cf38f597f1df0b146182ea0ecb79f06731c4ef77e47ba72d1d05118f399246e50e4514670d193b0f5c7f82a15fa329bbabad55a3d83e1d6760677c9eeb1583d76e9bbf6f01c786f821312f6096f621d3e965e6e4e2298ab5cc6df05210ef04ca641bfe[0m [36mSignature-Input[0m=[35mkeyid="bc4a5eaf76012122fc442d85c7317e1a7023e4cf30864235117935bab46423d9", created=1756786813, expires=1756787113, alg="RSA"[0m [36mWorkload-Geo-ID[0m=[35m{"client_workload_id":"agent-001","client_workload_location":{"region":"US","state":"California","city":"Santa Clara"},"client_workload_location_type":"geographic-region","client_workload_location_quality":"GNSS","client_type":"thick"}[0m [36mendpoint[0m=[35m/metrics[0m [36mmethod[0m=[35mPOST[0m
INFO:__main__:[2m2025-09-02T04:20:13.368988Z[0m [[32m[1minfo     [0m] [1müîç [GATEWAY] API call headers for policy enforcement debugging[0m [[34m[1m__main__[0m] [36mclient_ip[0m=[35mNone[0m [36mcontent_type[0m=[35mapplication/json[0m [36mendpoint[0m=[35m/metrics[0m [36mexpected_headers_for_endpoint[0m=[35mWorkload-Geo-ID + Signature-Input + Signature[0m [36mmethod[0m=[35mPOST[0m [36mpath[0m=[35m/metrics[0m [36mquery_params[0m=[35m{}[0m [36msignature_input_present[0m=[35mTrue[0m [36msignature_input_value[0m=[35mkeyid="bc4a5eaf76012122fc442d85c7317e1a7023e4cf30864235117935bab46423d9", created=1756786813, expires=1756787113, alg="RSA"[0m [36msignature_present[0m=[35mTrue[0m [36msignature_value[0m=[35m255cc7722eb72af0c2b5bb72d36a432d2a7f73073348413db79d3fd6c79f8533...[0m [36muser_agent[0m=[35mpython-requests/2.31.0[0m [36mworkload_geo_id_present[0m=[35mTrue[0m [36mworkload_geo_id_value[0m=[35m{"client_workload_id":"agent-001","client_workload_location":{"region":"US","state":"California","city":"Santa Clara"},"client_workload_location_type":"geographic-region","client_workload_location_quality":"GNSS","client_type":"thick"}[0m
INFO:__main__:[2m2025-09-02T04:20:13.373533Z[0m [[32m[1minfo     [0m] [1müìã [GATEWAY] Policy enforcement header summary[0m [[34m[1m__main__[0m] [36mendpoint[0m=[35m/metrics[0m [36mgeolocation_header_present[0m=[35mTrue[0m [36mpolicy_enforcement_ready[0m=[35mTrue[0m [36msignature_header_present[0m=[35mTrue[0m [36msignature_input_present[0m=[35mTrue[0m
INFO:__main__:[2m2025-09-02T04:20:13.374068Z[0m [[32m[1minfo     [0m] [1mSecurityManager checking validation conditions for non-nonce request[0m [[34m[1m__main__[0m] [36mvalidate_geolocation[0m=[35mTrue[0m [36mvalidate_public_key_hash[0m=[35mTrue[0m [36mvalidate_signature[0m=[35mTrue[0m
INFO:__main__:[2m2025-09-02T04:20:13.374439Z[0m [[32m[1minfo     [0m] [1mSecurityManager calling validate_request_headers[0m [[34m[1m__main__[0m] 
INFO:__main__:[2m2025-09-02T04:20:13.376148Z[0m [[32m[1minfo     [0m] [1mGateway validate_request_headers called[0m [[34m[1m__main__[0m] [36mheaders_present[0m=[35m['Host', 'User-Agent', 'Accept-Encoding', 'Accept', 'Connection', 'Content-Type', 'Workload-Geo-Id', 'Signature-Input', 'Signature', 'Content-Length', 'Traceparent'][0m [36mvalidate_geolocation[0m=[35mTrue[0m
INFO:__main__:[2m2025-09-02T04:20:13.376426Z[0m [[32m[1minfo     [0m] [1müö® [GATEWAY] VALIDATE_SIGNATURE_METHOD_CALLED[0m [[34m[1m__main__[0m] [36mhas_signature[0m=[35mTrue[0m [36mhas_workload_geo_id[0m=[35mTrue[0m [36mpublic_key_hash[0m=[35mbc4a5eaf76012122fc442d85c7317e1a7023e4cf30864235117935bab46423d9[0m
INFO:__main__:[2m2025-09-02T04:20:13.376741Z[0m [[32m[1minfo     [0m] [1müö® [GATEWAY] SIGNATURE_VERIFICATION_ENTRY_POINT[0m [[34m[1m__main__[0m] [36magent_name[0m=[35magent-001[0m [36mvalidate_signature[0m=[35mTrue[0m [36mworkload_geo_id_present[0m=[35mTrue[0m
INFO:__main__:[2m2025-09-02T04:20:13.377230Z[0m [[32m[1minfo     [0m] [1müö® [GATEWAY] SIGNATURE_DEBUG_DATA_VERIFIED[0m [[34m[1m__main__[0m] [36magent_name[0m=[35magent-001[0m [36mdata_length[0m=[35m235[0m [36mdata_sha256[0m=[35m1644c707c28e275d...[0m [36mformat_match[0m=[35mTrue[0m [36mpublic_key_hash[0m=[35mbc4a5eaf76012122fc442d85c7317e1a7023e4cf30864235117935bab46423d9[0m [36mworkload_geo_id_canonical[0m=[35m{"client_workload_id":"agent-001","client_workload_location":{"region":"US","state":"California","city":"Santa Clara"},"client_workload_location_type":"geographic-region","client_workload_location_quality":"GNSS","client_type":"thick"}[0m [36mworkload_geo_id_original[0m=[35m{"client_workload_id":"agent-001","client_workload_location":{"region":"US","state":"California","city":"Santa Clara"},"client_workload_location_type":"geographic-region","client_workload_location_quality":"GNSS","client_type":"thick"}[0m
INFO:__main__:[2m2025-09-02T04:20:13.377545Z[0m [[32m[1minfo     [0m] [1müîç [GATEWAY] Using shell script signature verification (same as collector)[0m [[34m[1m__main__[0m] [36magent_name[0m=[35magent-001[0m [36mdata_length[0m=[35m235[0m [36mpublic_key_hash[0m=[35mbc4a5eaf76012122fc442d85c7317e1a7023e4cf30864235117935bab46423d9[0m [36msignature_length[0m=[35m256[0m
INFO:__main__:[2m2025-09-02T04:20:13.378106Z[0m [[32m[1minfo     [0m] [1müîç [GATEWAY] Running verification script[0m [[34m[1m__main__[0m] [36magent_name[0m=[35magent-001[0m [36mdata_length[0m=[35m235[0m [36mscript_path[0m=[35m/mnt/c/Users/ramkr/AegisEdgeAI/zero-trust/tpm/verify_app_message_signature.sh[0m [36msignature_length[0m=[35m256[0m
INFO:__main__:[2m2025-09-02T04:20:13.409457Z[0m [[32m[1minfo     [0m] [1müîç [GATEWAY] Shell script verification result[0m [[34m[1m__main__[0m] [36magent_name[0m=[35magent-001[0m [36mis_valid[0m=[35mTrue[0m [36mreturn_code[0m=[35m0[0m [36mstderr[0m=[35m[0m [36mstdout[0m=[35m[INFO] Hashing the message with SHA-256...
[INFO] Verifying signature with OpenSSL pkeyutl...
Signature Verified Successfully
[INFO] Signature valid![0m
INFO:__main__:[2m2025-09-02T04:20:13.410083Z[0m [[32m[1minfo     [0m] [1m‚úÖ [GATEWAY] Workload-Geo-ID signature verification successful[0m [[34m[1m__main__[0m] [36magent_name[0m=[35magent-001[0m [36malgorithm[0m=[35mRSA[0m [36mpublic_key_hash[0m=[35mbc4a5eaf76012122fc442d85c7317e1a7023e4cf30864235117935bab46423d9[0m [36msignature_length[0m=[35m256[0m
INFO:__main__:[2m2025-09-02T04:20:13.410527Z[0m [[32m[1minfo     [0m] [1mGateway checking geolocation validation[0m [[34m[1m__main__[0m] [36mvalidate_geolocation[0m=[35mTrue[0m [36mworkload_geo_id_str[0m=[35m{"client_workload_id":"agent-001","client_workload_location":{"region":"US","state":"California","city":"Santa Clara"},"client_workload_location_type":"geographic-region","client_workload_location_quality":"GNSS","client_type":"thick"}[0m
INFO:__main__:[2m2025-09-02T04:20:13.410762Z[0m [[32m[1minfo     [0m] [1mGateway geolocation validation called[0m [[34m[1m__main__[0m] [36mpublic_key_hash[0m=[35mbc4a5eaf76012122fc442d85c7317e1a7023e4cf30864235117935bab46423d9[0m [36mworkload_geo_id[0m=[35m{'client_workload_id': 'agent-001', 'client_workload_location': {'region': 'US', 'state': 'California', 'city': 'Santa Clara'}, 'client_workload_location_type': 'geographic-region', 'client_workload_location_quality': 'GNSS', 'client_type': 'thick'}[0m
INFO:__main__:[2m2025-09-02T04:20:13.410967Z[0m [[32m[1minfo     [0m] [1mGateway geolocation comparison[0m [[34m[1m__main__[0m] [36mactual_city[0m=[35mSANTA CLARA[0m [36mactual_country[0m=[35mUS[0m [36mactual_state[0m=[35mCALIFORNIA[0m [36magent_name[0m=[35magent-001[0m [36mexpected_city[0m=[35mSANTA CLARA[0m [36mexpected_country[0m=[35mUS[0m [36mexpected_state[0m=[35mCALIFORNIA[0m
INFO:__main__:[2m2025-09-02T04:20:13.411164Z[0m [[32m[1minfo     [0m] [1mGeolocation validation passed [0m [[34m[1m__main__[0m] [36mactual_geo[0m=[35m{'region': 'US', 'state': 'California', 'city': 'Santa Clara'}[0m [36magent_name[0m=[35magent-001[0m [36mexpected_geo[0m=[35m{'country': 'US', 'state': 'California', 'city': 'Santa Clara'}[0m
INFO:__main__:[2m2025-09-02T04:20:13.411356Z[0m [[32m[1minfo     [0m] [1mGateway geolocation validation result[0m [[34m[1m__main__[0m] [36mvalidation_result[0m=[35m{'valid': True, 'agent': {'agent_name': 'agent-001', 'tpm_public_key': 'MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAshJ0YLqQeqox0TNUtNKwu3IsBlytxw83Nd/BfTwOmXif4//umUlYYYERV9QF6jpkSAOW/5dSEgl8h+6/7tKEIjPpxGhlk1M7tx2TMoWgiwu+KajMnBNC3x735CUYEH7lOt5UGRGH+gkENgK5RPrYBIG/seDzXR/CxtpGXgHT/guQC/QW+79WPcEVl+Gpj5peNKxSxQQA5meYhQmVEzrM6bNpEhapjT4ncoMas2Fnw13yzxRxEAS+oKzxfXzEsx+fXjPQC7M//GHBZ0IUUxhHNpWTHiRfdsyF5UaQaaNXRpBoQzC6GL25sG06+mZKtRdn5rY7M7TzFrRfvjtdVIYMXQIDAQAB', 'tpm_public_key_hash': 'bc4a5eaf76012122fc442d85c7317e1a7023e4cf30864235117935bab46423d9', 'geolocation': {'country': 'US', 'state': 'California', 'city': 'Santa Clara'}, 'status': 'active', 'created_at': '2025-08-15T18:00:00Z'}, 'reason': 'Geolocation validation passed'}[0m
INFO:__main__:[2m2025-09-02T04:20:13.411543Z[0m [[32m[1minfo     [0m] [1mSecurityManager validation result[0m [[34m[1m__main__[0m] [36mvalidation_result[0m=[35m{'valid': True, 'agent': {'agent_name': 'agent-001', 'tpm_public_key': 'MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAshJ0YLqQeqox0TNUtNKwu3IsBlytxw83Nd/BfTwOmXif4//umUlYYYERV9QF6jpkSAOW/5dSEgl8h+6/7tKEIjPpxGhlk1M7tx2TMoWgiwu+KajMnBNC3x735CUYEH7lOt5UGRGH+gkENgK5RPrYBIG/seDzXR/CxtpGXgHT/guQC/QW+79WPcEVl+Gpj5peNKxSxQQA5meYhQmVEzrM6bNpEhapjT4ncoMas2Fnw13yzxRxEAS+oKzxfXzEsx+fXjPQC7M//GHBZ0IUUxhHNpWTHiRfdsyF5UaQaaNXRpBoQzC6GL25sG06+mZKtRdn5rY7M7TzFrRfvjtdVIYMXQIDAQAB', 'tpm_public_key_hash': 'bc4a5eaf76012122fc442d85c7317e1a7023e4cf30864235117935bab46423d9', 'geolocation': {'country': 'US', 'state': 'California', 'city': 'Santa Clara'}, 'status': 'active', 'created_at': '2025-08-15T18:00:00Z'}, 'reason': 'All validations passed'}[0m
INFO:__main__:[2m2025-09-02T04:20:13.457021Z[0m [[32m[1minfo     [0m] [1mMetrics request proxied successfully[0m [[34m[1m__main__[0m] 
INFO:__main__:[2m2025-09-02T04:20:13.513782Z[0m [[32m[1minfo     [0m] [1müîç [GATEWAY] Full relevant headers for policy enforcement debugging[0m [[34m[1m__main__[0m] [36mContent-Type[0m=[35mNone[0m [36mSignature[0m=[35mNone[0m [36mSignature-Input[0m=[35mkeyid="9c6de813c7eeeaa3c3e0b0c0b4c2c443e2f69a61273802832a7328753353bf2a", created=1756786813, expires=1756787113, alg="RSA"[0m [36mWorkload-Geo-ID[0m=[35mNone[0m [36mendpoint[0m=[35m/nonce[0m [36mmethod[0m=[35mGET[0m
INFO:__main__:[2m2025-09-02T04:20:13.514471Z[0m [[32m[1minfo     [0m] [1müîç [GATEWAY] API call headers for policy enforcement debugging[0m [[34m[1m__main__[0m] [36mclient_ip[0m=[35mNone[0m [36mcontent_type[0m=[35mNone[0m [36mendpoint[0m=[35m/nonce[0m [36mexpected_headers_for_endpoint[0m=[35mSignature-Input only (no geolocation)[0m [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/nonce[0m [36mquery_params[0m=[35m{'public_key_hash': '9c6de813c7eeeaa3c3e0b0c0b4c2c443e2f69a61273802832a7328753353bf2a'}[0m [36msignature_input_present[0m=[35mTrue[0m [36msignature_input_value[0m=[35mkeyid="9c6de813c7eeeaa3c3e0b0c0b4c2c443e2f69a61273802832a7328753353bf2a", created=1756786813, expires=1756787113, alg="RSA"[0m [36msignature_present[0m=[35mFalse[0m [36msignature_value[0m=[35mNone[0m [36muser_agent[0m=[35mpython-requests/2.31.0[0m [36mworkload_geo_id_present[0m=[35mFalse[0m [36mworkload_geo_id_value[0m=[35mNone[0m
INFO:__main__:[2m2025-09-02T04:20:13.516326Z[0m [[32m[1minfo     [0m] [1müìã [GATEWAY] Policy enforcement header summary[0m [[34m[1m__main__[0m] [36mendpoint[0m=[35m/nonce[0m [36mgeolocation_header_present[0m=[35mFalse[0m [36mpolicy_enforcement_ready[0m=[35mTrue[0m [36msignature_header_present[0m=[35mFalse[0m [36msignature_input_present[0m=[35mTrue[0m
INFO:__main__:[2m2025-09-02T04:20:13.516750Z[0m [[32m[1minfo     [0m] [1mSecurityManager validating nonce request - public key hash only[0m [[34m[1m__main__[0m] 
INFO:__main__:[2m2025-09-02T04:20:13.517028Z[0m [[32m[1minfo     [0m] [1m‚úÖ [GATEWAY] Nonce validation passed - public key hash only[0m [[34m[1m__main__[0m] 
INFO:__main__:[2m2025-09-02T04:20:13.542356Z[0m [[32m[1minfo     [0m] [1mNonce request proxied successfully[0m [[34m[1m__main__[0m] 
INFO:__main__:[2m2025-09-02T04:20:13.761538Z[0m [[32m[1minfo     [0m] [1müîç [GATEWAY] Full relevant headers for policy enforcement debugging[0m [[34m[1m__main__[0m] [36mContent-Type[0m=[35mapplication/json[0m [36mSignature[0m=[35m3ab2d26051e2b4d2331d8f43eef039cccfb0e2cc1664c1890c98eee5576fdaa717bdb6c508d68364af1d310048663d6897d05bed9b03c255f395bb324167eef80c175dfcb4b1eb846a3c8e15573acea96bf7b6dbfb578761a6db0b14f933ecb7862d0a8d0cc9c4d512be6519ae562df39134dc3cfb233f27c5bec0d0711f43b3c8378600a2bdb8bb8ec719a85d55548f1de625ce1eec272da53d2104ec45f157fcf76a7c7ddb7df988951c7f07fe9a55048280e68e1c2b97c92c07a878b8b7c73f8e48a6b857778c5fc3b2dae62965f2d32d98ba162ad062e0d5bc00b3755a64d5a9ed6e444a08ae5021a8ec0d0649409f60fe9b32b9815d960a302d3d01f74d[0m [36mSignature-Input[0m=[35mkeyid="9c6de813c7eeeaa3c3e0b0c0b4c2c443e2f69a61273802832a7328753353bf2a", created=1756786813, expires=1756787113, alg="RSA"[0m [36mWorkload-Geo-ID[0m=[35m{"client_workload_id":"agent-geo-policy-violation-002","client_workload_location":{"region":"EU","state":"Germany","city":"Berlin"},"client_workload_location_type":"geographic-region","client_workload_location_quality":"GNSS","client_type":"thick"}[0m [36mendpoint[0m=[35m/metrics[0m [36mmethod[0m=[35mPOST[0m
INFO:__main__:[2m2025-09-02T04:20:13.761965Z[0m [[32m[1minfo     [0m] [1müîç [GATEWAY] API call headers for policy enforcement debugging[0m [[34m[1m__main__[0m] [36mclient_ip[0m=[35mNone[0m [36mcontent_type[0m=[35mapplication/json[0m [36mendpoint[0m=[35m/metrics[0m [36mexpected_headers_for_endpoint[0m=[35mWorkload-Geo-ID + Signature-Input + Signature[0m [36mmethod[0m=[35mPOST[0m [36mpath[0m=[35m/metrics[0m [36mquery_params[0m=[35m{}[0m [36msignature_input_present[0m=[35mTrue[0m [36msignature_input_value[0m=[35mkeyid="9c6de813c7eeeaa3c3e0b0c0b4c2c443e2f69a61273802832a7328753353bf2a", created=1756786813, expires=1756787113, alg="RSA"[0m [36msignature_present[0m=[35mTrue[0m [36msignature_value[0m=[35m3ab2d26051e2b4d2331d8f43eef039cccfb0e2cc1664c1890c98eee5576fdaa7...[0m [36muser_agent[0m=[35mpython-requests/2.31.0[0m [36mworkload_geo_id_present[0m=[35mTrue[0m [36mworkload_geo_id_value[0m=[35m{"client_workload_id":"agent-geo-policy-violation-002","client_workload_location":{"region":"EU","state":"Germany","city":"Berlin"},"client_workload_location_type":"geographic-region","client_workload_location_quality":"GNSS","client_type":"thick"}[0m
INFO:__main__:[2m2025-09-02T04:20:13.763823Z[0m [[32m[1minfo     [0m] [1müìã [GATEWAY] Policy enforcement header summary[0m [[34m[1m__main__[0m] [36mendpoint[0m=[35m/metrics[0m [36mgeolocation_header_present[0m=[35mTrue[0m [36mpolicy_enforcement_ready[0m=[35mTrue[0m [36msignature_header_present[0m=[35mTrue[0m [36msignature_input_present[0m=[35mTrue[0m
INFO:__main__:[2m2025-09-02T04:20:13.764116Z[0m [[32m[1minfo     [0m] [1mSecurityManager checking validation conditions for non-nonce request[0m [[34m[1m__main__[0m] [36mvalidate_geolocation[0m=[35mTrue[0m [36mvalidate_public_key_hash[0m=[35mTrue[0m [36mvalidate_signature[0m=[35mTrue[0m
INFO:__main__:[2m2025-09-02T04:20:13.764319Z[0m [[32m[1minfo     [0m] [1mSecurityManager calling validate_request_headers[0m [[34m[1m__main__[0m] 
INFO:__main__:[2m2025-09-02T04:20:13.764531Z[0m [[32m[1minfo     [0m] [1mGateway validate_request_headers called[0m [[34m[1m__main__[0m] [36mheaders_present[0m=[35m['Host', 'User-Agent', 'Accept-Encoding', 'Accept', 'Connection', 'Content-Type', 'Workload-Geo-Id', 'Signature-Input', 'Signature', 'Content-Length', 'Traceparent'][0m [36mvalidate_geolocation[0m=[35mTrue[0m
INFO:__main__:[2m2025-09-02T04:20:13.764699Z[0m [[32m[1minfo     [0m] [1müö® [GATEWAY] VALIDATE_SIGNATURE_METHOD_CALLED[0m [[34m[1m__main__[0m] [36mhas_signature[0m=[35mTrue[0m [36mhas_workload_geo_id[0m=[35mTrue[0m [36mpublic_key_hash[0m=[35m9c6de813c7eeeaa3c3e0b0c0b4c2c443e2f69a61273802832a7328753353bf2a[0m
INFO:__main__:[2m2025-09-02T04:20:13.764897Z[0m [[32m[1minfo     [0m] [1müö® [GATEWAY] SIGNATURE_VERIFICATION_ENTRY_POINT[0m [[34m[1m__main__[0m] [36magent_name[0m=[35magent-geo-policy-violation-002[0m [36mvalidate_signature[0m=[35mTrue[0m [36mworkload_geo_id_present[0m=[35mTrue[0m
INFO:__main__:[2m2025-09-02T04:20:13.765082Z[0m [[32m[1minfo     [0m] [1müö® [GATEWAY] SIGNATURE_DEBUG_DATA_VERIFIED[0m [[34m[1m__main__[0m] [36magent_name[0m=[35magent-geo-policy-violation-002[0m [36mdata_length[0m=[35m248[0m [36mdata_sha256[0m=[35mc1ee6213cd03f7d8...[0m [36mformat_match[0m=[35mTrue[0m [36mpublic_key_hash[0m=[35m9c6de813c7eeeaa3c3e0b0c0b4c2c443e2f69a61273802832a7328753353bf2a[0m [36mworkload_geo_id_canonical[0m=[35m{"client_workload_id":"agent-geo-policy-violation-002","client_workload_location":{"region":"EU","state":"Germany","city":"Berlin"},"client_workload_location_type":"geographic-region","client_workload_location_quality":"GNSS","client_type":"thick"}[0m [36mworkload_geo_id_original[0m=[35m{"client_workload_id":"agent-geo-policy-violation-002","client_workload_location":{"region":"EU","state":"Germany","city":"Berlin"},"client_workload_location_type":"geographic-region","client_workload_location_quality":"GNSS","client_type":"thick"}[0m
INFO:__main__:[2m2025-09-02T04:20:13.765233Z[0m [[32m[1minfo     [0m] [1müîç [GATEWAY] Using shell script signature verification (same as collector)[0m [[34m[1m__main__[0m] [36magent_name[0m=[35magent-geo-policy-violation-002[0m [36mdata_length[0m=[35m248[0m [36mpublic_key_hash[0m=[35m9c6de813c7eeeaa3c3e0b0c0b4c2c443e2f69a61273802832a7328753353bf2a[0m [36msignature_length[0m=[35m256[0m
INFO:__main__:[2m2025-09-02T04:20:13.765568Z[0m [[32m[1minfo     [0m] [1müîç [GATEWAY] Running verification script[0m [[34m[1m__main__[0m] [36magent_name[0m=[35magent-geo-policy-violation-002[0m [36mdata_length[0m=[35m248[0m [36mscript_path[0m=[35m/mnt/c/Users/ramkr/AegisEdgeAI/zero-trust/tpm/verify_app_message_signature.sh[0m [36msignature_length[0m=[35m256[0m
INFO:__main__:[2m2025-09-02T04:20:13.818275Z[0m [[32m[1minfo     [0m] [1müîç [GATEWAY] Shell script verification result[0m [[34m[1m__main__[0m] [36magent_name[0m=[35magent-geo-policy-violation-002[0m [36mis_valid[0m=[35mTrue[0m [36mreturn_code[0m=[35m0[0m [36mstderr[0m=[35m[0m [36mstdout[0m=[35m[INFO] Hashing the message with SHA-256...
[INFO] Verifying signature with OpenSSL pkeyutl...
Signature Verified Successfully
[INFO] Signature valid![0m
INFO:__main__:[2m2025-09-02T04:20:13.818738Z[0m [[32m[1minfo     [0m] [1m‚úÖ [GATEWAY] Workload-Geo-ID signature verification successful[0m [[34m[1m__main__[0m] [36magent_name[0m=[35magent-geo-policy-violation-002[0m [36malgorithm[0m=[35mRSA[0m [36mpublic_key_hash[0m=[35m9c6de813c7eeeaa3c3e0b0c0b4c2c443e2f69a61273802832a7328753353bf2a[0m [36msignature_length[0m=[35m256[0m
INFO:__main__:[2m2025-09-02T04:20:13.819110Z[0m [[32m[1minfo     [0m] [1mGateway checking geolocation validation[0m [[34m[1m__main__[0m] [36mvalidate_geolocation[0m=[35mTrue[0m [36mworkload_geo_id_str[0m=[35m{"client_workload_id":"agent-geo-policy-violation-002","client_workload_location":{"region":"EU","state":"Germany","city":"Berlin"},"client_workload_location_type":"geographic-region","client_workload_location_quality":"GNSS","client_type":"thick"}[0m
INFO:__main__:[2m2025-09-02T04:20:13.819426Z[0m [[32m[1minfo     [0m] [1mGateway geolocation validation called[0m [[34m[1m__main__[0m] [36mpublic_key_hash[0m=[35m9c6de813c7eeeaa3c3e0b0c0b4c2c443e2f69a61273802832a7328753353bf2a[0m [36mworkload_geo_id[0m=[35m{'client_workload_id': 'agent-geo-policy-violation-002', 'client_workload_location': {'region': 'EU', 'state': 'Germany', 'city': 'Berlin'}, 'client_workload_location_type': 'geographic-region', 'client_workload_location_quality': 'GNSS', 'client_type': 'thick'}[0m
INFO:__main__:[2m2025-09-02T04:20:13.819942Z[0m [[32m[1minfo     [0m] [1mGateway geolocation comparison[0m [[34m[1m__main__[0m] [36mactual_city[0m=[35mBERLIN[0m [36mactual_country[0m=[35mEU[0m [36mactual_state[0m=[35mGERMANY[0m [36magent_name[0m=[35magent-geo-policy-violation-002[0m [36mexpected_city[0m=[35mSANTA CLARA[0m [36mexpected_country[0m=[35mUS[0m [36mexpected_state[0m=[35mCALIFORNIA[0m
WARNING:__main__:[2m2025-09-02T04:20:13.820290Z[0m [[33m[1mwarning  [0m] [1mGateway geolocation validation result[0m [[34m[1m__main__[0m] [36mvalidation_result[0m=[35m{'valid': False, 'reason': 'Geolocation verification failed', 'details': {'expected': {'country': 'US', 'state': 'California', 'city': 'Santa Clara'}, 'received': {'region': 'EU', 'state': 'Germany', 'city': 'Berlin'}, 'agent_name': 'agent-geo-policy-violation-002'}}[0m
WARNING:__main__:[2m2025-09-02T04:20:13.820548Z[0m [[33m[1mwarning  [0m] [1mSecurityManager validation result[0m [[34m[1m__main__[0m] [36mvalidation_result[0m=[35m{'valid': False, 'reason': 'Geolocation verification failed', 'details': {'expected': {'country': 'US', 'state': 'California', 'city': 'Santa Clara'}, 'received': {'region': 'EU', 'state': 'Germany', 'city': 'Berlin'}, 'agent_name': 'agent-geo-policy-violation-002'}}[0m
INFO:__main__:[2m2025-09-02T04:20:13.924697Z[0m [[32m[1minfo     [0m] [1müîç [GATEWAY] Full relevant headers for policy enforcement debugging[0m [[34m[1m__main__[0m] [36mContent-Type[0m=[35mNone[0m [36mSignature[0m=[35mNone[0m [36mSignature-Input[0m=[35mkeyid="324bc8707ab6226a40ebf9560415c35b8d6545f80d17fe8382abe06047dc07c5", created=1756786813, expires=1756787113, alg="RSA"[0m [36mWorkload-Geo-ID[0m=[35mNone[0m [36mendpoint[0m=[35m/nonce[0m [36mmethod[0m=[35mGET[0m
INFO:__main__:[2m2025-09-02T04:20:13.925211Z[0m [[32m[1minfo     [0m] [1müîç [GATEWAY] API call headers for policy enforcement debugging[0m [[34m[1m__main__[0m] [36mclient_ip[0m=[35mNone[0m [36mcontent_type[0m=[35mNone[0m [36mendpoint[0m=[35m/nonce[0m [36mexpected_headers_for_endpoint[0m=[35mSignature-Input only (no geolocation)[0m [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/nonce[0m [36mquery_params[0m=[35m{'public_key_hash': '324bc8707ab6226a40ebf9560415c35b8d6545f80d17fe8382abe06047dc07c5'}[0m [36msignature_input_present[0m=[35mTrue[0m [36msignature_input_value[0m=[35mkeyid="324bc8707ab6226a40ebf9560415c35b8d6545f80d17fe8382abe06047dc07c5", created=1756786813, expires=1756787113, alg="RSA"[0m [36msignature_present[0m=[35mFalse[0m [36msignature_value[0m=[35mNone[0m [36muser_agent[0m=[35mpython-requests/2.31.0[0m [36mworkload_geo_id_present[0m=[35mFalse[0m [36mworkload_geo_id_value[0m=[35mNone[0m
INFO:__main__:[2m2025-09-02T04:20:13.927060Z[0m [[32m[1minfo     [0m] [1müìã [GATEWAY] Policy enforcement header summary[0m [[34m[1m__main__[0m] [36mendpoint[0m=[35m/nonce[0m [36mgeolocation_header_present[0m=[35mFalse[0m [36mpolicy_enforcement_ready[0m=[35mTrue[0m [36msignature_header_present[0m=[35mFalse[0m [36msignature_input_present[0m=[35mTrue[0m
INFO:__main__:[2m2025-09-02T04:20:13.927486Z[0m [[32m[1minfo     [0m] [1mSecurityManager validating nonce request - public key hash only[0m [[34m[1m__main__[0m] 
WARNING:__main__:[2m2025-09-02T04:20:13.927814Z[0m [[33m[1mwarning  [0m] [1m‚ùå [GATEWAY] Nonce request from unauthorized agent[0m [[34m[1m__main__[0m] [36magent_public_key_hash[0m=[35m324bc8707ab6226a...[0m [36mrequest_ip[0m=[35m127.0.0.1[0m
