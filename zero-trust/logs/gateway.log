INFO:__main__:[2m2025-09-01T17:19:54.845508Z[0m [[32m[1minfo     [0m] [1mGateway logging configuration [0m [[34m[1m__main__[0m] [36mdebug_all[0m=[35mFalse[0m [36mdebug_gateway[0m=[35mFalse[0m [36mlog_level[0m=[35mINFO[0m
INFO:__main__:[2m2025-09-01T17:19:54.853466Z[0m [[32m[1minfo     [0m] [1mSkipping OpenTelemetry metrics setup for compatibility[0m [[34m[1m__main__[0m] 
INFO:__main__:[2m2025-09-01T17:19:54.854489Z[0m [[32m[1minfo     [0m] [1mOpenTelemetry setup completed (OTLP export disabled)[0m [[34m[1m__main__[0m] 
INFO:__main__:[2m2025-09-01T17:19:54.858415Z[0m [[32m[1minfo     [0m] [1mGateway allowlist loaded      [0m [[34m[1m__main__[0m] [36magent_count[0m=[35m2[0m [36mpath[0m=[35mgateway/allowed_agents.json[0m
INFO:__main__:[2m2025-09-01T17:19:54.858690Z[0m [[32m[1minfo     [0m] [1müö® [GATEWAY] SIGNATURE_VALIDATION_CONFIG[0m [[34m[1m__main__[0m] [36menv_var_value[0m=[35mtrue[0m [36mvalidate_signature[0m=[35mTrue[0m
INFO:__main__:[2m2025-09-01T17:19:54.858861Z[0m [[32m[1minfo     [0m] [1mGateway allowlist manager initialized[0m [[34m[1m__main__[0m] [36magent_count[0m=[35m2[0m [36mallowlist_path[0m=[35mgateway/allowed_agents.json[0m [36mvalidate_geolocation[0m=[35mTrue[0m [36mvalidate_public_key_hash[0m=[35mTrue[0m [36mvalidate_signature[0m=[35mTrue[0m
INFO:__main__:[2m2025-09-01T17:19:54.959793Z[0m [[32m[1minfo     [0m] [1mGenerated temporary SSL certificates[0m [[34m[1m__main__[0m] [36mcert_path[0m=[35m/tmp/tmp3vwzw88l.pem[0m [36mkey_path[0m=[35m/tmp/tmpet4d9ucy.pem[0m
 * Serving Flask app 'app'
 * Debug mode: off
INFO:__main__:[2m2025-09-01T17:19:56.928602Z[0m [[32m[1minfo     [0m] [1müîç [GATEWAY] Full relevant headers for policy enforcement debugging[0m [[34m[1m__main__[0m] [36mContent-Type[0m=[35mNone[0m [36mSignature[0m=[35mNone[0m [36mSignature-Input[0m=[35mkeyid="08ff306a8e4f9c8dd32ae0f83b1dbf4edf162a4f1d6e872c8c25bcb777fbb619", created=1756747196, expires=1756747496, alg="Ed25519"[0m [36mWorkload-Geo-ID[0m=[35mNone[0m [36mendpoint[0m=[35m/nonce[0m [36mmethod[0m=[35mGET[0m
INFO:__main__:[2m2025-09-01T17:19:56.929295Z[0m [[32m[1minfo     [0m] [1müîç [GATEWAY] API call headers for policy enforcement debugging[0m [[34m[1m__main__[0m] [36mclient_ip[0m=[35mNone[0m [36mcontent_type[0m=[35mNone[0m [36mendpoint[0m=[35m/nonce[0m [36mexpected_headers_for_endpoint[0m=[35mSignature-Input only (no geolocation)[0m [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/nonce[0m [36mquery_params[0m=[35m{'public_key_hash': '08ff306a8e4f9c8dd32ae0f83b1dbf4edf162a4f1d6e872c8c25bcb777fbb619'}[0m [36msignature_input_present[0m=[35mTrue[0m [36msignature_input_value[0m=[35mkeyid="08ff306a8e4f9c8dd32ae0f83b1dbf4edf162a4f1d6e872c8c25bcb777fbb619", created=1756747196, expires=1756747496, alg="Ed25519"[0m [36msignature_present[0m=[35mFalse[0m [36msignature_value[0m=[35mNone[0m [36muser_agent[0m=[35mpython-requests/2.31.0[0m [36mworkload_geo_id_present[0m=[35mFalse[0m [36mworkload_geo_id_value[0m=[35mNone[0m
INFO:__main__:[2m2025-09-01T17:19:56.932569Z[0m [[32m[1minfo     [0m] [1müìã [GATEWAY] Policy enforcement header summary[0m [[34m[1m__main__[0m] [36mendpoint[0m=[35m/nonce[0m [36mgeolocation_header_present[0m=[35mFalse[0m [36mpolicy_enforcement_ready[0m=[35mTrue[0m [36msignature_header_present[0m=[35mFalse[0m [36msignature_input_present[0m=[35mTrue[0m
INFO:__main__:[2m2025-09-01T17:19:56.933142Z[0m [[32m[1minfo     [0m] [1mSecurityManager validating nonce request - public key hash only[0m [[34m[1m__main__[0m] 
INFO:__main__:[2m2025-09-01T17:19:56.935463Z[0m [[32m[1minfo     [0m] [1m‚úÖ [GATEWAY] Nonce validation passed - public key hash only[0m [[34m[1m__main__[0m] 
INFO:__main__:[2m2025-09-01T17:19:56.967527Z[0m [[32m[1minfo     [0m] [1mNonce request proxied successfully[0m [[34m[1m__main__[0m] 
INFO:__main__:[2m2025-09-01T17:19:57.176563Z[0m [[32m[1minfo     [0m] [1müîç [GATEWAY] Full relevant headers for policy enforcement debugging[0m [[34m[1m__main__[0m] [36mContent-Type[0m=[35mapplication/json[0m [36mSignature[0m=[35mb6a336b113ce86a613af440efc42e4bfa939b8060b0dc81f60a3655066c69581c2d965f26fa58c4c59d500b34a995675029edb7cec1122a5c72a7df7b4bd2785bcb1650403477f71af57aa8ce873da65d6c2fe11d56a835287ded9bdfc2010b5043c12166c9921f49b49975597a7ef4a74925a4906a26cad2b457b0dfb4f3763242576ec0a74e0ff15ee1e5df756cbd2b872b5d52355c729f908b55aa225f121875a3e726f8daf913dfcc130955e7792acab5b88ffd3b7b116f802abd2db9cd3110ac681ad1c99ae21484d1536393f410f94452cb4adb832a55e4dfe5961ce1d06061a9f9b889416a67602c3bf8a1b04054000be1b7a7e336151c69a5668c2ab[0m [36mSignature-Input[0m=[35mkeyid="08ff306a8e4f9c8dd32ae0f83b1dbf4edf162a4f1d6e872c8c25bcb777fbb619", created=1756747197, expires=1756747497, alg="Ed25519"[0m [36mWorkload-Geo-ID[0m=[35m{"client_workload_id":"agent-001","client_workload_location":{"region":"US","state":"California","city":"Santa Clara"},"client_workload_location_type":"geographic-region","client_workload_location_quality":"GNSS","client_type":"thick"}[0m [36mendpoint[0m=[35m/metrics[0m [36mmethod[0m=[35mPOST[0m
INFO:__main__:[2m2025-09-01T17:19:57.177079Z[0m [[32m[1minfo     [0m] [1müîç [GATEWAY] API call headers for policy enforcement debugging[0m [[34m[1m__main__[0m] [36mclient_ip[0m=[35mNone[0m [36mcontent_type[0m=[35mapplication/json[0m [36mendpoint[0m=[35m/metrics[0m [36mexpected_headers_for_endpoint[0m=[35mWorkload-Geo-ID + Signature-Input + Signature[0m [36mmethod[0m=[35mPOST[0m [36mpath[0m=[35m/metrics[0m [36mquery_params[0m=[35m{}[0m [36msignature_input_present[0m=[35mTrue[0m [36msignature_input_value[0m=[35mkeyid="08ff306a8e4f9c8dd32ae0f83b1dbf4edf162a4f1d6e872c8c25bcb777fbb619", created=1756747197, expires=1756747497, alg="Ed25519"[0m [36msignature_present[0m=[35mTrue[0m [36msignature_value[0m=[35mb6a336b113ce86a613af440efc42e4bfa939b8060b0dc81f60a3655066c69581...[0m [36muser_agent[0m=[35mpython-requests/2.31.0[0m [36mworkload_geo_id_present[0m=[35mTrue[0m [36mworkload_geo_id_value[0m=[35m{"client_workload_id":"agent-001","client_workload_location":{"region":"US","state":"California","city":"Santa Clara"},"client_workload_location_type":"geographic-region","client_workload_location_quality":"GNSS","client_type":"thick"}[0m
INFO:__main__:[2m2025-09-01T17:19:57.179724Z[0m [[32m[1minfo     [0m] [1müìã [GATEWAY] Policy enforcement header summary[0m [[34m[1m__main__[0m] [36mendpoint[0m=[35m/metrics[0m [36mgeolocation_header_present[0m=[35mTrue[0m [36mpolicy_enforcement_ready[0m=[35mTrue[0m [36msignature_header_present[0m=[35mTrue[0m [36msignature_input_present[0m=[35mTrue[0m
INFO:__main__:[2m2025-09-01T17:19:57.180035Z[0m [[32m[1minfo     [0m] [1mSecurityManager checking validation conditions for non-nonce request[0m [[34m[1m__main__[0m] [36mvalidate_geolocation[0m=[35mTrue[0m [36mvalidate_public_key_hash[0m=[35mTrue[0m [36mvalidate_signature[0m=[35mTrue[0m
INFO:__main__:[2m2025-09-01T17:19:57.180260Z[0m [[32m[1minfo     [0m] [1mSecurityManager calling validate_request_headers[0m [[34m[1m__main__[0m] 
INFO:__main__:[2m2025-09-01T17:19:57.180454Z[0m [[32m[1minfo     [0m] [1mGateway validate_request_headers called[0m [[34m[1m__main__[0m] [36mheaders_present[0m=[35m['Host', 'User-Agent', 'Accept-Encoding', 'Accept', 'Connection', 'Content-Type', 'Workload-Geo-Id', 'Signature-Input', 'Signature', 'Content-Length', 'Traceparent'][0m [36mvalidate_geolocation[0m=[35mTrue[0m
INFO:__main__:[2m2025-09-01T17:19:57.180637Z[0m [[32m[1minfo     [0m] [1müö® [GATEWAY] VALIDATE_SIGNATURE_METHOD_CALLED[0m [[34m[1m__main__[0m] [36mhas_signature[0m=[35mTrue[0m [36mhas_workload_geo_id[0m=[35mTrue[0m [36mpublic_key_hash[0m=[35m08ff306a8e4f9c8dd32ae0f83b1dbf4edf162a4f1d6e872c8c25bcb777fbb619[0m
INFO:__main__:[2m2025-09-01T17:19:57.180923Z[0m [[32m[1minfo     [0m] [1müö® [GATEWAY] SIGNATURE_VERIFICATION_ENTRY_POINT[0m [[34m[1m__main__[0m] [36magent_name[0m=[35magent-001[0m [36mvalidate_signature[0m=[35mTrue[0m [36mworkload_geo_id_present[0m=[35mTrue[0m
INFO:__main__:[2m2025-09-01T17:19:57.181248Z[0m [[32m[1minfo     [0m] [1müö® [GATEWAY] SIGNATURE_DEBUG_DATA_VERIFIED[0m [[34m[1m__main__[0m] [36magent_name[0m=[35magent-001[0m [36mdata_length[0m=[35m235[0m [36mdata_sha256[0m=[35m1644c707c28e275d...[0m [36mformat_match[0m=[35mTrue[0m [36mpublic_key_hash[0m=[35m08ff306a8e4f9c8dd32ae0f83b1dbf4edf162a4f1d6e872c8c25bcb777fbb619[0m [36mworkload_geo_id_canonical[0m=[35m{"client_workload_id":"agent-001","client_workload_location":{"region":"US","state":"California","city":"Santa Clara"},"client_workload_location_type":"geographic-region","client_workload_location_quality":"GNSS","client_type":"thick"}[0m [36mworkload_geo_id_original[0m=[35m{"client_workload_id":"agent-001","client_workload_location":{"region":"US","state":"California","city":"Santa Clara"},"client_workload_location_type":"geographic-region","client_workload_location_quality":"GNSS","client_type":"thick"}[0m
INFO:__main__:[2m2025-09-01T17:19:57.181591Z[0m [[32m[1minfo     [0m] [1müîç [GATEWAY] Using shell script signature verification (same as collector)[0m [[34m[1m__main__[0m] [36magent_name[0m=[35magent-001[0m [36mdata_length[0m=[35m235[0m [36mpublic_key_hash[0m=[35m08ff306a8e4f9c8dd32ae0f83b1dbf4edf162a4f1d6e872c8c25bcb777fbb619[0m [36msignature_length[0m=[35m256[0m
INFO:__main__:[2m2025-09-01T17:19:57.181946Z[0m [[32m[1minfo     [0m] [1müîç [GATEWAY] Running verification script[0m [[34m[1m__main__[0m] [36magent_name[0m=[35magent-001[0m [36mdata_length[0m=[35m235[0m [36mscript_path[0m=[35m/mnt/c/Users/ramkr/AegisEdgeAI/zero-trust/tpm/verify_app_message_signature.sh[0m [36msignature_length[0m=[35m256[0m
INFO:__main__:[2m2025-09-01T17:19:57.212445Z[0m [[32m[1minfo     [0m] [1müîç [GATEWAY] Shell script verification result[0m [[34m[1m__main__[0m] [36magent_name[0m=[35magent-001[0m [36mis_valid[0m=[35mTrue[0m [36mreturn_code[0m=[35m0[0m [36mstderr[0m=[35m[0m [36mstdout[0m=[35m[INFO] Hashing the message with SHA-256...
[INFO] Verifying signature with OpenSSL pkeyutl...
Signature Verified Successfully
[INFO] Signature valid![0m
INFO:__main__:[2m2025-09-01T17:19:57.212777Z[0m [[32m[1minfo     [0m] [1m‚úÖ [GATEWAY] Workload-Geo-ID signature verification successful[0m [[34m[1m__main__[0m] [36magent_name[0m=[35magent-001[0m [36malgorithm[0m=[35mEd25519[0m [36mpublic_key_hash[0m=[35m08ff306a8e4f9c8dd32ae0f83b1dbf4edf162a4f1d6e872c8c25bcb777fbb619[0m [36msignature_length[0m=[35m256[0m
INFO:__main__:[2m2025-09-01T17:19:57.212996Z[0m [[32m[1minfo     [0m] [1mGateway checking geolocation validation[0m [[34m[1m__main__[0m] [36mvalidate_geolocation[0m=[35mTrue[0m [36mworkload_geo_id_str[0m=[35m{"client_workload_id":"agent-001","client_workload_location":{"region":"US","state":"California","city":"Santa Clara"},"client_workload_location_type":"geographic-region","client_workload_location_quality":"GNSS","client_type":"thick"}[0m
INFO:__main__:[2m2025-09-01T17:19:57.213175Z[0m [[32m[1minfo     [0m] [1mGateway geolocation validation called[0m [[34m[1m__main__[0m] [36mpublic_key_hash[0m=[35m08ff306a8e4f9c8dd32ae0f83b1dbf4edf162a4f1d6e872c8c25bcb777fbb619[0m [36mworkload_geo_id[0m=[35m{'client_workload_id': 'agent-001', 'client_workload_location': {'region': 'US', 'state': 'California', 'city': 'Santa Clara'}, 'client_workload_location_type': 'geographic-region', 'client_workload_location_quality': 'GNSS', 'client_type': 'thick'}[0m
INFO:__main__:[2m2025-09-01T17:19:57.213459Z[0m [[32m[1minfo     [0m] [1mGateway geolocation comparison[0m [[34m[1m__main__[0m] [36mactual_city[0m=[35mSANTA CLARA[0m [36mactual_country[0m=[35mUS[0m [36mactual_state[0m=[35mCALIFORNIA[0m [36magent_name[0m=[35magent-001[0m [36mexpected_city[0m=[35mSANTA CLARA[0m [36mexpected_country[0m=[35mUS[0m [36mexpected_state[0m=[35mCALIFORNIA[0m
INFO:__main__:[2m2025-09-01T17:19:57.213681Z[0m [[32m[1minfo     [0m] [1mGeolocation validation passed [0m [[34m[1m__main__[0m] [36mactual_geo[0m=[35m{'region': 'US', 'state': 'California', 'city': 'Santa Clara'}[0m [36magent_name[0m=[35magent-001[0m [36mexpected_geo[0m=[35m{'country': 'US', 'state': 'California', 'city': 'Santa Clara'}[0m
INFO:__main__:[2m2025-09-01T17:19:57.213818Z[0m [[32m[1minfo     [0m] [1mGateway geolocation validation result[0m [[34m[1m__main__[0m] [36mvalidation_result[0m=[35m{'valid': True, 'agent': {'agent_name': 'agent-001', 'tpm_public_key': 'MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAw82UABaGrinvC2U96mPchC53Wi0XPDvTPDj8cnBPd1Mvew3xfTGjz8/xGeEUjLFHrBrdk1TFIXGEzY1OqS0eaVnp/YzJ6dn3U3heAdZKVdW8I9tWu82aFGiz0DL0UB2I0nApWgxbry6okPhakXq9Ct8K7e7Nixq9NDAUzpGz4j6Q4a6xQyYwHdz+OoBy70Js/wcMkQvcyXk3mwIRCX1lVOG3iT4bisBnw4FvJkuKudXc4yyXiBC6KQ3fw1imHmKUNTf9ep6Yp+vYzAFK4FzhcUY2WL/LpcdjFlGZNQ8WCt0EoJckohNHgdzoq0CsAQTyTNlzIGJ6S6prLroI9QrlXwIDAQAB', 'tpm_public_key_hash': '08ff306a8e4f9c8dd32ae0f83b1dbf4edf162a4f1d6e872c8c25bcb777fbb619', 'geolocation': {'country': 'US', 'state': 'California', 'city': 'Santa Clara'}, 'status': 'active', 'created_at': '2025-08-15T18:00:00Z'}, 'reason': 'Geolocation validation passed'}[0m
INFO:__main__:[2m2025-09-01T17:19:57.213949Z[0m [[32m[1minfo     [0m] [1mSecurityManager validation result[0m [[34m[1m__main__[0m] [36mvalidation_result[0m=[35m{'valid': True, 'agent': {'agent_name': 'agent-001', 'tpm_public_key': 'MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAw82UABaGrinvC2U96mPchC53Wi0XPDvTPDj8cnBPd1Mvew3xfTGjz8/xGeEUjLFHrBrdk1TFIXGEzY1OqS0eaVnp/YzJ6dn3U3heAdZKVdW8I9tWu82aFGiz0DL0UB2I0nApWgxbry6okPhakXq9Ct8K7e7Nixq9NDAUzpGz4j6Q4a6xQyYwHdz+OoBy70Js/wcMkQvcyXk3mwIRCX1lVOG3iT4bisBnw4FvJkuKudXc4yyXiBC6KQ3fw1imHmKUNTf9ep6Yp+vYzAFK4FzhcUY2WL/LpcdjFlGZNQ8WCt0EoJckohNHgdzoq0CsAQTyTNlzIGJ6S6prLroI9QrlXwIDAQAB', 'tpm_public_key_hash': '08ff306a8e4f9c8dd32ae0f83b1dbf4edf162a4f1d6e872c8c25bcb777fbb619', 'geolocation': {'country': 'US', 'state': 'California', 'city': 'Santa Clara'}, 'status': 'active', 'created_at': '2025-08-15T18:00:00Z'}, 'reason': 'All validations passed'}[0m
INFO:__main__:[2m2025-09-01T17:19:57.255859Z[0m [[32m[1minfo     [0m] [1mMetrics request proxied successfully[0m [[34m[1m__main__[0m] 
INFO:__main__:[2m2025-09-01T17:19:57.318920Z[0m [[32m[1minfo     [0m] [1müîç [GATEWAY] Full relevant headers for policy enforcement debugging[0m [[34m[1m__main__[0m] [36mContent-Type[0m=[35mNone[0m [36mSignature[0m=[35mNone[0m [36mSignature-Input[0m=[35mkeyid="0bf59af4ef572d0e0adb379190d72b5e413ca892c7018226bd15617a46f9fc1c", created=1756747197, expires=1756747497, alg="Ed25519"[0m [36mWorkload-Geo-ID[0m=[35mNone[0m [36mendpoint[0m=[35m/nonce[0m [36mmethod[0m=[35mGET[0m
INFO:__main__:[2m2025-09-01T17:19:57.319479Z[0m [[32m[1minfo     [0m] [1müîç [GATEWAY] API call headers for policy enforcement debugging[0m [[34m[1m__main__[0m] [36mclient_ip[0m=[35mNone[0m [36mcontent_type[0m=[35mNone[0m [36mendpoint[0m=[35m/nonce[0m [36mexpected_headers_for_endpoint[0m=[35mSignature-Input only (no geolocation)[0m [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/nonce[0m [36mquery_params[0m=[35m{'public_key_hash': '0bf59af4ef572d0e0adb379190d72b5e413ca892c7018226bd15617a46f9fc1c'}[0m [36msignature_input_present[0m=[35mTrue[0m [36msignature_input_value[0m=[35mkeyid="0bf59af4ef572d0e0adb379190d72b5e413ca892c7018226bd15617a46f9fc1c", created=1756747197, expires=1756747497, alg="Ed25519"[0m [36msignature_present[0m=[35mFalse[0m [36msignature_value[0m=[35mNone[0m [36muser_agent[0m=[35mpython-requests/2.31.0[0m [36mworkload_geo_id_present[0m=[35mFalse[0m [36mworkload_geo_id_value[0m=[35mNone[0m
INFO:__main__:[2m2025-09-01T17:19:57.324559Z[0m [[32m[1minfo     [0m] [1müìã [GATEWAY] Policy enforcement header summary[0m [[34m[1m__main__[0m] [36mendpoint[0m=[35m/nonce[0m [36mgeolocation_header_present[0m=[35mFalse[0m [36mpolicy_enforcement_ready[0m=[35mTrue[0m [36msignature_header_present[0m=[35mFalse[0m [36msignature_input_present[0m=[35mTrue[0m
INFO:__main__:[2m2025-09-01T17:19:57.324850Z[0m [[32m[1minfo     [0m] [1mSecurityManager validating nonce request - public key hash only[0m [[34m[1m__main__[0m] 
INFO:__main__:[2m2025-09-01T17:19:57.325138Z[0m [[32m[1minfo     [0m] [1m‚úÖ [GATEWAY] Nonce validation passed - public key hash only[0m [[34m[1m__main__[0m] 
INFO:__main__:[2m2025-09-01T17:19:57.345170Z[0m [[32m[1minfo     [0m] [1mNonce request proxied successfully[0m [[34m[1m__main__[0m] 
INFO:__main__:[2m2025-09-01T17:19:57.553858Z[0m [[32m[1minfo     [0m] [1müîç [GATEWAY] Full relevant headers for policy enforcement debugging[0m [[34m[1m__main__[0m] [36mContent-Type[0m=[35mapplication/json[0m [36mSignature[0m=[35m12c8808b963054dd9c6e52dc26b3e2ea2b7c8f90d1de7f79ca9497ef4cf06d32dd5fc6cd9daf68fab4753767ca4738e1a5d3e5c88ea81bad5495db2556d3e36bc8f1634460f7c05255dea1552c78dc033245e25af175637af66fa0535bb0d232dda4fae2219042074cff769e3dfe83b16b18b3f7f8bdb7f35b17d781b599ca68e3a4ade901e03fcb378231c69a784f27636508af79a83c61858b844171783ef21bd89d580c93495b3934f18d2c6a52a6aaa2118cf61c459fd1cbc3ef1e7a8d341f49c3e62bbeb7959c4073bb0d727bbecd0e8f1b2490a6138f1c261ad36a7f1a8af39010ffe3e3f71fe61b7b8ef8b8dec009fc23f4b28a9d5734cf2d79d7d190[0m [36mSignature-Input[0m=[35mkeyid="0bf59af4ef572d0e0adb379190d72b5e413ca892c7018226bd15617a46f9fc1c", created=1756747197, expires=1756747497, alg="Ed25519"[0m [36mWorkload-Geo-ID[0m=[35m{"client_workload_id":"agent-geo-policy-violation-002","client_workload_location":{"region":"EU","state":"Germany","city":"Berlin"},"client_workload_location_type":"geographic-region","client_workload_location_quality":"GNSS","client_type":"thick"}[0m [36mendpoint[0m=[35m/metrics[0m [36mmethod[0m=[35mPOST[0m
INFO:__main__:[2m2025-09-01T17:19:57.554263Z[0m [[32m[1minfo     [0m] [1müîç [GATEWAY] API call headers for policy enforcement debugging[0m [[34m[1m__main__[0m] [36mclient_ip[0m=[35mNone[0m [36mcontent_type[0m=[35mapplication/json[0m [36mendpoint[0m=[35m/metrics[0m [36mexpected_headers_for_endpoint[0m=[35mWorkload-Geo-ID + Signature-Input + Signature[0m [36mmethod[0m=[35mPOST[0m [36mpath[0m=[35m/metrics[0m [36mquery_params[0m=[35m{}[0m [36msignature_input_present[0m=[35mTrue[0m [36msignature_input_value[0m=[35mkeyid="0bf59af4ef572d0e0adb379190d72b5e413ca892c7018226bd15617a46f9fc1c", created=1756747197, expires=1756747497, alg="Ed25519"[0m [36msignature_present[0m=[35mTrue[0m [36msignature_value[0m=[35m12c8808b963054dd9c6e52dc26b3e2ea2b7c8f90d1de7f79ca9497ef4cf06d32...[0m [36muser_agent[0m=[35mpython-requests/2.31.0[0m [36mworkload_geo_id_present[0m=[35mTrue[0m [36mworkload_geo_id_value[0m=[35m{"client_workload_id":"agent-geo-policy-violation-002","client_workload_location":{"region":"EU","state":"Germany","city":"Berlin"},"client_workload_location_type":"geographic-region","client_workload_location_quality":"GNSS","client_type":"thick"}[0m
INFO:__main__:[2m2025-09-01T17:19:57.556011Z[0m [[32m[1minfo     [0m] [1müìã [GATEWAY] Policy enforcement header summary[0m [[34m[1m__main__[0m] [36mendpoint[0m=[35m/metrics[0m [36mgeolocation_header_present[0m=[35mTrue[0m [36mpolicy_enforcement_ready[0m=[35mTrue[0m [36msignature_header_present[0m=[35mTrue[0m [36msignature_input_present[0m=[35mTrue[0m
INFO:__main__:[2m2025-09-01T17:19:57.556338Z[0m [[32m[1minfo     [0m] [1mSecurityManager checking validation conditions for non-nonce request[0m [[34m[1m__main__[0m] [36mvalidate_geolocation[0m=[35mTrue[0m [36mvalidate_public_key_hash[0m=[35mTrue[0m [36mvalidate_signature[0m=[35mTrue[0m
INFO:__main__:[2m2025-09-01T17:19:57.556561Z[0m [[32m[1minfo     [0m] [1mSecurityManager calling validate_request_headers[0m [[34m[1m__main__[0m] 
INFO:__main__:[2m2025-09-01T17:19:57.556783Z[0m [[32m[1minfo     [0m] [1mGateway validate_request_headers called[0m [[34m[1m__main__[0m] [36mheaders_present[0m=[35m['Host', 'User-Agent', 'Accept-Encoding', 'Accept', 'Connection', 'Content-Type', 'Workload-Geo-Id', 'Signature-Input', 'Signature', 'Content-Length', 'Traceparent'][0m [36mvalidate_geolocation[0m=[35mTrue[0m
INFO:__main__:[2m2025-09-01T17:19:57.556998Z[0m [[32m[1minfo     [0m] [1müö® [GATEWAY] VALIDATE_SIGNATURE_METHOD_CALLED[0m [[34m[1m__main__[0m] [36mhas_signature[0m=[35mTrue[0m [36mhas_workload_geo_id[0m=[35mTrue[0m [36mpublic_key_hash[0m=[35m0bf59af4ef572d0e0adb379190d72b5e413ca892c7018226bd15617a46f9fc1c[0m
INFO:__main__:[2m2025-09-01T17:19:57.557202Z[0m [[32m[1minfo     [0m] [1müö® [GATEWAY] SIGNATURE_VERIFICATION_ENTRY_POINT[0m [[34m[1m__main__[0m] [36magent_name[0m=[35magent-geo-policy-violation-002[0m [36mvalidate_signature[0m=[35mTrue[0m [36mworkload_geo_id_present[0m=[35mTrue[0m
INFO:__main__:[2m2025-09-01T17:19:57.557402Z[0m [[32m[1minfo     [0m] [1müö® [GATEWAY] SIGNATURE_DEBUG_DATA_VERIFIED[0m [[34m[1m__main__[0m] [36magent_name[0m=[35magent-geo-policy-violation-002[0m [36mdata_length[0m=[35m248[0m [36mdata_sha256[0m=[35mc1ee6213cd03f7d8...[0m [36mformat_match[0m=[35mTrue[0m [36mpublic_key_hash[0m=[35m0bf59af4ef572d0e0adb379190d72b5e413ca892c7018226bd15617a46f9fc1c[0m [36mworkload_geo_id_canonical[0m=[35m{"client_workload_id":"agent-geo-policy-violation-002","client_workload_location":{"region":"EU","state":"Germany","city":"Berlin"},"client_workload_location_type":"geographic-region","client_workload_location_quality":"GNSS","client_type":"thick"}[0m [36mworkload_geo_id_original[0m=[35m{"client_workload_id":"agent-geo-policy-violation-002","client_workload_location":{"region":"EU","state":"Germany","city":"Berlin"},"client_workload_location_type":"geographic-region","client_workload_location_quality":"GNSS","client_type":"thick"}[0m
INFO:__main__:[2m2025-09-01T17:19:57.557602Z[0m [[32m[1minfo     [0m] [1müîç [GATEWAY] Using shell script signature verification (same as collector)[0m [[34m[1m__main__[0m] [36magent_name[0m=[35magent-geo-policy-violation-002[0m [36mdata_length[0m=[35m248[0m [36mpublic_key_hash[0m=[35m0bf59af4ef572d0e0adb379190d72b5e413ca892c7018226bd15617a46f9fc1c[0m [36msignature_length[0m=[35m256[0m
INFO:__main__:[2m2025-09-01T17:19:57.557979Z[0m [[32m[1minfo     [0m] [1müîç [GATEWAY] Running verification script[0m [[34m[1m__main__[0m] [36magent_name[0m=[35magent-geo-policy-violation-002[0m [36mdata_length[0m=[35m248[0m [36mscript_path[0m=[35m/mnt/c/Users/ramkr/AegisEdgeAI/zero-trust/tpm/verify_app_message_signature.sh[0m [36msignature_length[0m=[35m256[0m
INFO:__main__:[2m2025-09-01T17:19:57.585144Z[0m [[32m[1minfo     [0m] [1müîç [GATEWAY] Shell script verification result[0m [[34m[1m__main__[0m] [36magent_name[0m=[35magent-geo-policy-violation-002[0m [36mis_valid[0m=[35mTrue[0m [36mreturn_code[0m=[35m0[0m [36mstderr[0m=[35m[0m [36mstdout[0m=[35m[INFO] Hashing the message with SHA-256...
[INFO] Verifying signature with OpenSSL pkeyutl...
Signature Verified Successfully
[INFO] Signature valid![0m
INFO:__main__:[2m2025-09-01T17:19:57.585490Z[0m [[32m[1minfo     [0m] [1m‚úÖ [GATEWAY] Workload-Geo-ID signature verification successful[0m [[34m[1m__main__[0m] [36magent_name[0m=[35magent-geo-policy-violation-002[0m [36malgorithm[0m=[35mEd25519[0m [36mpublic_key_hash[0m=[35m0bf59af4ef572d0e0adb379190d72b5e413ca892c7018226bd15617a46f9fc1c[0m [36msignature_length[0m=[35m256[0m
INFO:__main__:[2m2025-09-01T17:19:57.585789Z[0m [[32m[1minfo     [0m] [1mGateway checking geolocation validation[0m [[34m[1m__main__[0m] [36mvalidate_geolocation[0m=[35mTrue[0m [36mworkload_geo_id_str[0m=[35m{"client_workload_id":"agent-geo-policy-violation-002","client_workload_location":{"region":"EU","state":"Germany","city":"Berlin"},"client_workload_location_type":"geographic-region","client_workload_location_quality":"GNSS","client_type":"thick"}[0m
INFO:__main__:[2m2025-09-01T17:19:57.586083Z[0m [[32m[1minfo     [0m] [1mGateway geolocation validation called[0m [[34m[1m__main__[0m] [36mpublic_key_hash[0m=[35m0bf59af4ef572d0e0adb379190d72b5e413ca892c7018226bd15617a46f9fc1c[0m [36mworkload_geo_id[0m=[35m{'client_workload_id': 'agent-geo-policy-violation-002', 'client_workload_location': {'region': 'EU', 'state': 'Germany', 'city': 'Berlin'}, 'client_workload_location_type': 'geographic-region', 'client_workload_location_quality': 'GNSS', 'client_type': 'thick'}[0m
INFO:__main__:[2m2025-09-01T17:19:57.586274Z[0m [[32m[1minfo     [0m] [1mGateway geolocation comparison[0m [[34m[1m__main__[0m] [36mactual_city[0m=[35mBERLIN[0m [36mactual_country[0m=[35mEU[0m [36mactual_state[0m=[35mGERMANY[0m [36magent_name[0m=[35magent-geo-policy-violation-002[0m [36mexpected_city[0m=[35mSANTA CLARA[0m [36mexpected_country[0m=[35mUS[0m [36mexpected_state[0m=[35mCALIFORNIA[0m
WARNING:__main__:[2m2025-09-01T17:19:57.586448Z[0m [[33m[1mwarning  [0m] [1mGateway geolocation validation result[0m [[34m[1m__main__[0m] [36mvalidation_result[0m=[35m{'valid': False, 'reason': 'Geolocation verification failed', 'details': {'expected': {'country': 'US', 'state': 'California', 'city': 'Santa Clara'}, 'received': {'region': 'EU', 'state': 'Germany', 'city': 'Berlin'}, 'agent_name': 'agent-geo-policy-violation-002'}}[0m
WARNING:__main__:[2m2025-09-01T17:19:57.586638Z[0m [[33m[1mwarning  [0m] [1mSecurityManager validation result[0m [[34m[1m__main__[0m] [36mvalidation_result[0m=[35m{'valid': False, 'reason': 'Geolocation verification failed', 'details': {'expected': {'country': 'US', 'state': 'California', 'city': 'Santa Clara'}, 'received': {'region': 'EU', 'state': 'Germany', 'city': 'Berlin'}, 'agent_name': 'agent-geo-policy-violation-002'}}[0m
INFO:__main__:[2m2025-09-01T17:19:57.644429Z[0m [[32m[1minfo     [0m] [1müîç [GATEWAY] Full relevant headers for policy enforcement debugging[0m [[34m[1m__main__[0m] [36mContent-Type[0m=[35mNone[0m [36mSignature[0m=[35mNone[0m [36mSignature-Input[0m=[35mkeyid="78dabca36067f8e9215c4152a03c6634f082a9998437eba6a8118049c239cdd4", created=1756747197, expires=1756747497, alg="Ed25519"[0m [36mWorkload-Geo-ID[0m=[35mNone[0m [36mendpoint[0m=[35m/nonce[0m [36mmethod[0m=[35mGET[0m
INFO:__main__:[2m2025-09-01T17:19:57.644827Z[0m [[32m[1minfo     [0m] [1müîç [GATEWAY] API call headers for policy enforcement debugging[0m [[34m[1m__main__[0m] [36mclient_ip[0m=[35mNone[0m [36mcontent_type[0m=[35mNone[0m [36mendpoint[0m=[35m/nonce[0m [36mexpected_headers_for_endpoint[0m=[35mSignature-Input only (no geolocation)[0m [36mmethod[0m=[35mGET[0m [36mpath[0m=[35m/nonce[0m [36mquery_params[0m=[35m{'public_key_hash': '78dabca36067f8e9215c4152a03c6634f082a9998437eba6a8118049c239cdd4'}[0m [36msignature_input_present[0m=[35mTrue[0m [36msignature_input_value[0m=[35mkeyid="78dabca36067f8e9215c4152a03c6634f082a9998437eba6a8118049c239cdd4", created=1756747197, expires=1756747497, alg="Ed25519"[0m [36msignature_present[0m=[35mFalse[0m [36msignature_value[0m=[35mNone[0m [36muser_agent[0m=[35mpython-requests/2.31.0[0m [36mworkload_geo_id_present[0m=[35mFalse[0m [36mworkload_geo_id_value[0m=[35mNone[0m
INFO:__main__:[2m2025-09-01T17:19:57.646456Z[0m [[32m[1minfo     [0m] [1müìã [GATEWAY] Policy enforcement header summary[0m [[34m[1m__main__[0m] [36mendpoint[0m=[35m/nonce[0m [36mgeolocation_header_present[0m=[35mFalse[0m [36mpolicy_enforcement_ready[0m=[35mTrue[0m [36msignature_header_present[0m=[35mFalse[0m [36msignature_input_present[0m=[35mTrue[0m
INFO:__main__:[2m2025-09-01T17:19:57.646846Z[0m [[32m[1minfo     [0m] [1mSecurityManager validating nonce request - public key hash only[0m [[34m[1m__main__[0m] 
WARNING:__main__:[2m2025-09-01T17:19:57.647275Z[0m [[33m[1mwarning  [0m] [1m‚ùå [GATEWAY] Nonce request from unauthorized agent[0m [[34m[1m__main__[0m] [36magent_public_key_hash[0m=[35m78dabca36067f8e9...[0m [36mrequest_ip[0m=[35m127.0.0.1[0m
