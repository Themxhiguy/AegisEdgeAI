INFO:agent.app:[2m2025-08-27T21:34:41.827111Z[0m [[32m[1minfo     [0m] [1mAgent logging configuration   [0m [[34m[1magent.app[0m] [36mdebug_agent[0m=[35mFalse[0m [36mdebug_all[0m=[35mFalse[0m [36mlog_level[0m=[35mINFO[0m
INFO:agent.app:[2m2025-08-27T21:34:41.845065Z[0m [[32m[1minfo     [0m] [1mUsing agent-specific TPM context file[0m [[34m[1magent.app[0m] [36magent_name[0m=[35magent-geo-policy-violation-002[0m [36mcontext_path[0m=[35mtpm/agent-geo-policy-violation-002.ctx[0m
INFO:utils.tpm2_utils:[2m2025-08-27T21:34:41.849117Z[0m [[32m[1minfo     [0m] [1mSoftware TPM (swtpm) is accessible[0m [[34m[1mutils.tpm2_utils[0m] 
INFO:agent.app:[2m2025-08-27T21:34:41.853545Z[0m [[32m[1minfo     [0m] [1mTPM2 utilities initialized successfully[0m [[34m[1magent.app[0m] [36magent_name[0m=[35magent-geo-policy-violation-002[0m [36mcontext_path[0m=[35mtpm/agent-geo-policy-violation-002.ctx[0m [36muse_swtpm[0m=[35mTrue[0m
INFO:agent.app:[2m2025-08-27T21:34:41.861849Z[0m [[32m[1minfo     [0m] [1mSkipping OpenTelemetry metrics setup for compatibility[0m [[34m[1magent.app[0m] 
INFO:agent.app:[2m2025-08-27T21:34:41.862901Z[0m [[32m[1minfo     [0m] [1mOpenTelemetry setup completed (OTLP export disabled)[0m [[34m[1magent.app[0m] 
üöÄ Starting agent: agent-geo-policy-violation-002
üìÅ Config file: agents/agent-geo-policy-violation-002/config.json
üåê Agent port: 8402
üîê APP_HANDLE: 0x8101000C
üîó Gateway: localhost:9000
üìä Collector: localhost:8500
 * Serving Flask app 'agent.app'
 * Debug mode: off
INFO:agent.app:[2m2025-08-27T21:34:42.632254Z[0m [[32m[1minfo     [0m] [1müîÑ [AGENT] Initiating nonce retrieval for metrics[0m [[34m[1magent.app[0m] [36magent_name[0m=[35magent-geo-policy-violation-002[0m [36mmetric_type[0m=[35mapplication[0m
INFO:agent.app:[2m2025-08-27T21:34:42.632703Z[0m [[32m[1minfo     [0m] [1müîÑ [AGENT] Starting nonce request[0m [[34m[1magent.app[0m] [36magent_name[0m=[35magent-geo-policy-violation-002[0m [36mconfig_path[0m=[35magents/agent-geo-policy-violation-002/config.json[0m [36mgateway_url[0m=[35mhttps://localhost:9000[0m
INFO:agent.app:[2m2025-08-27T21:34:42.637607Z[0m [[32m[1minfo     [0m] [1müì§ [AGENT] Sending nonce request to gateway[0m [[34m[1magent.app[0m] [36magent_name[0m=[35magent-geo-policy-violation-002[0m [36mpublic_key_hash[0m=[35m8b3567c8f38fb81f...[0m
INFO:agent.app:[2m2025-08-27T21:34:42.637823Z[0m [[32m[1minfo     [0m] [1müîç [AGENT] Signature-Input header created[0m [[34m[1magent.app[0m] [36magent_name[0m=[35magent-geo-policy-violation-002[0m [36msignature_input[0m=[35mkeyid="8b3567c8f38fb81f3aad3f52cb671398d13916ca8b6ba4068086dca6da9fc282", created=1756330482, expires=1756330782, alg="Ed25519"[0m
INFO:agent.app:[2m2025-08-27T21:34:42.638006Z[0m [[32m[1minfo     [0m] [1müì§ [AGENT] Final headers for nonce request (public key hash only)[0m [[34m[1magent.app[0m] [36magent_name[0m=[35magent-geo-policy-violation-002[0m [36mheaders[0m=[35m{'Signature-Input': 'keyid="8b3567c8f38fb81f3aad3f52cb671398d13916ca8b6ba4068086dca6da9fc282", created=1756330482, expires=1756330782, alg="Ed25519"'}[0m
INFO:agent.app:[2m2025-08-27T21:34:42.685817Z[0m [[32m[1minfo     [0m] [1m‚úÖ [AGENT] Nonce received successfully[0m [[34m[1magent.app[0m] [36magent_name[0m=[35magent-geo-policy-violation-002[0m [36mnonce_length[0m=[35m32[0m [36mnonce_value[0m=[35m4be7df4626e7bc30...[0m [36mpublic_key_hash[0m=[35m8b3567c8f38fb81f...[0m [36mresponse_status[0m=[35m200[0m
INFO:agent.app:[2m2025-08-27T21:34:42.686863Z[0m [[32m[1minfo     [0m] [1m‚úÖ [AGENT] Nonce retrieved for metrics processing[0m [[34m[1magent.app[0m] [36magent_name[0m=[35magent-geo-policy-violation-002[0m [36mnonce_length[0m=[35m32[0m [36mnonce_value[0m=[35m4be7df4626e7bc30...[0m
INFO:agent.app:[2m2025-08-27T21:34:42.687572Z[0m [[32m[1minfo     [0m] [1mGeographic region configuration[0m [[34m[1magent.app[0m] [36magent_name[0m=[35magent-geo-policy-violation-002[0m [36magent_prefix[0m=[35mAGENT_GEO_POLICY_VIOLATION_002_[0m [36mcity[0m=[35mBerlin[0m [36mregion[0m=[35mEU[0m [36msource[0m=[35menv_override[0m [36mstate[0m=[35mGermany[0m
INFO:agent.app:[2m2025-08-27T21:34:42.688230Z[0m [[32m[1minfo     [0m] [1müîç [AGENT] Data prepared for signing[0m [[34m[1magent.app[0m] [36magent_name[0m=[35magent-geo-policy-violation-002[0m [36mdata_json[0m=[35m{"geographic_region": {"city": "Berlin", "region": "EU", "state": "Germany"}, "metrics": {"metrics": {"active_connections": 80, "error_rate": 1.7078444250811735, "requests_per_second": 23.038446258385356, "response_time_ms": 365.4066416267104}, "service": {"instance_id": "unknown", "name": "opentelemetry-agent", "version": "1.0.0"}, "timestamp": "2025-08-27T21:34:42.632210"}}[0m [36mdata_length[0m=[35m378[0m [36mnonce[0m=[35m4be7df4626e7bc3091f6984fa5bc2b63[0m
INFO:agent.app:[2m2025-08-27T21:34:42.784647Z[0m [[32m[1minfo     [0m] [1müîç [AGENT] Data signed successfully[0m [[34m[1magent.app[0m] [36magent_name[0m=[35magent-geo-policy-violation-002[0m [36malgorithm[0m=[35msha256[0m [36mdigest[0m=[35m1d09f47f3632d4d40a3ee2bc5cc43650...[0m [36msignature[0m=[35m1fdedc0ccc596405ca594b86ee6e3a02...[0m
INFO:agent.app:[2m2025-08-27T21:34:42.787193Z[0m [[32m[1minfo     [0m] [1müîç [AGENT] Payload created for sending[0m [[34m[1magent.app[0m] [36magent_name[0m=[35magent-geo-policy-violation-002[0m [36mmetrics_timestamp[0m=[35m2025-08-27T21:34:42.632210[0m [36mpayload_fields[0m=[35m['agent_name', 'tpm_public_key_hash', 'geolocation', 'metrics', 'geographic_region', 'nonce', 'signature', 'digest', 'algorithm', 'timestamp'][0m [36mpayload_timestamp[0m=[35m2025-08-27T21:34:42.787149[0m
INFO:agent.app:[2m2025-08-27T21:34:42.787479Z[0m [[32m[1minfo     [0m] [1müì§ [AGENT] Sending signed metrics to collector[0m [[34m[1magent.app[0m] [36magent_name[0m=[35magent-geo-policy-violation-002[0m [36mpayload_size[0m=[35m1307[0m [36msignature_length[0m=[35m512[0m
INFO:agent.app:[2m2025-08-27T21:34:42.787805Z[0m [[32m[1minfo     [0m] [1müîç [AGENT] Headers prepared for metrics request[0m [[34m[1magent.app[0m] [36magent_name[0m=[35magent-geo-policy-violation-002[0m [36mall_headers[0m=[35m{'Content-Type': 'application/json', 'Workload-Geo-ID': '{"client_workload_id":"agent-geo-policy-violation-002","client_workload_location":{"region":"EU","state":"Germany","city":"Berlin"},"client_workload_location_type":"geographic-region","client_workload_location_quality":"GNSS","client_type":"thick"}', 'Signature-Input': 'keyid="8b3567c8f38fb81f3aad3f52cb671398d13916ca8b6ba4068086dca6da9fc282", created=1756330482, expires=1756330782, alg="Ed25519"', 'Signature': '1fdedc0ccc596405ca594b86ee6e3a02fe52914ba0e668df4015a1d4f0dec2e5bdd865e39d2ea3e1141daecb58315cd8323c9f2c1b6ccba385ea5cd7ef2c0e98cb284e722501d589ff9b60f949edaaadbdf871ce8e2c91353aa037b585b646e5260359f4627794a12cd25253a6bdb1dc7585ce027b6c6dd05b84abaf7354cedbb699f371e6f57d4da66c6f8f0b07652b620d990689e42a9862b997b9af5a1351cdc0322f7f61078a3429af37eb5e15e1614246dd6da86be56e927a6642ee20cd1021bc47e6b0e8a47a971a91d774a5901ff7c679243cdef3d4662694acc89972ff6fa7d63affaf44e1c70499b1406845e0ccb55e018d2e52788fb4137d34b1cc'}[0m [36mgeographic_region[0m=[35m{'region': 'EU', 'state': 'Germany', 'city': 'Berlin'}[0m [36msignature_input_present[0m=[35mTrue[0m [36msignature_present[0m=[35mTrue[0m [36mworkload_geo_id_present[0m=[35mTrue[0m [36mworkload_geo_id_value[0m=[35m{"client_workload_id":"agent-geo-policy-violation-002","client_workload_location":{"region":"EU","st...[0m
INFO:agent.app:[2m2025-08-27T21:34:42.788064Z[0m [[32m[1minfo     [0m] [1müîç [AGENT] HTTP signature approach verification[0m [[34m[1magent.app[0m] [36magent_name[0m=[35magent-geo-policy-violation-002[0m [36mhttp_signature_nonce[0m=[35mN/A (payload signature only)[0m [36mpayload_nonce[0m=[35m4be7df4626e7bc3091f6984fa5bc2b63[0m [36msecurity_model[0m=[35mPayload signature validation only[0m
ERROR:agent.app:[2m2025-08-27T21:34:42.859317Z[0m [[31m[1merror    [0m] [1m‚ùå [AGENT] HTTP error from gateway[0m [[34m[1magent.app[0m] [36merror_details[0m=[35mGeolocation verification failed - {'agent_name': 'agent-geo-policy-violation-002', 'expected': {'city': 'Santa Clara', 'country': 'US', 'state': 'California'}, 'received': {'city': 'Berlin', 'region': 'EU', 'state': 'Germany'}}[0m [36mrejected_by[0m=[35mgateway[0m [36mresponse_text[0m=[35m{"details":{"agent_name":"agent-geo-policy-violation-002","expected":{"city":"Santa Clara","country":"US","state":"California"},"received":{"city":"Berlin","region":"EU","state":"Germany"}},"error":"G[0m [36mstatus_code[0m=[35m403[0m [36mvalidation_type[0m=[35mgeolocation_policy[0m
ERROR:agent.app:[2m2025-08-27T21:34:42.860136Z[0m [[31m[1merror    [0m] [1m‚ùå [AGENT] Failed to send metrics to gateway[0m [[34m[1magent.app[0m] [36magent_name[0m=[35magent-geo-policy-violation-002[0m [36merror_message[0m=[35mGeolocation verification failed - {'agent_name': 'agent-geo-policy-violation-002', 'expected': {'city': 'Santa Clara', 'country': 'US', 'state': 'California'}, 'received': {'city': 'Berlin', 'region': 'EU', 'state': 'Germany'}}[0m
