Can you generate a fully documented production style python code using flask framework for the following microservice architecture using REST HTTP 2.0 JSON. Make sure all microservices are using HTTPS and it's ok to generate self-signed certificates

OpenTelemetry Agent
1. Get nonce from openTelemetry collector
2. Generate metrics data 
3. Sign metrics data with nonce  using verify_app_signature.sh using tpm2_hash and tpm2_sign
4. Send payload to OpenTelemetry Collector

OpenTelemetry Collector
1. Give nonce to OpenTelemetry Agent
2. Receive metrics data and Verify nonce and signature and  using verify_app_signature.sh and using tpm2_verifysignature command

Man-in-the-middle API gateway
1. Terminates TLS connection from OpenTelemetry Agent
2. Reinitiates TLS connection to OpenTelemetry Collector

